{% extends "web/base.html" %}
{% block title %}Administrar Reservas{% endblock %}

{% block content %}

<div class="lux-admin-container">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="lux-title">Administraci√≥n de Reservas</h2>

        <a href="{% url 'admin_servicios' %}" class="btn lux-btn-outline">
            Administrar Servicios
        </a>
    </div>

    <!-- ================= CREAR RESERVA ================= -->
    <div class="lux-panel mb-5">
        <h4 class="lux-subtitle mb-3">Crear Reserva Manual</h4>

        <form method="POST" class="row g-3">
            {% csrf_token %}

            <div class="col-md-4">
                <label class="lux-label">Usuario</label>
                <select name="usuario" class="form-control lux-input" required>
                    <option value="">-- Seleccionar usuario --</option>
                    {% for u in usuarios %}
                    <option value="{{ u.id }}">{{ u.username }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-4">
                <label class="lux-label">Servicio</label>
                <select name="servicio" class="form-control lux-input" required>
                    <option value="">-- Seleccionar servicio --</option>
                    {% for s in servicios %}
                    <option value="{{ s.id }}">{{ s.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-4">
                <label class="lux-label">Fecha</label>
                <input type="date" class="form-control lux-input" name="fecha" min="{{ fecha_hoy }}" required>
            </div>

            <div class="col-md-4 mt-3">
                <label class="lux-label">Hora disponible</label>
                <select name="hora" class="form-control lux-input" required>
                    <option value="">-- Seleccionar fecha primero --</option>
                </select>
            </div>

            <div class="col-12 mt-4">
                <button class="btn lux-btn-gold">
                    Crear Reserva
                </button>
            </div>
        </form>
    </div>

    <!-- ================= RESERVAS ACTIVAS ================= -->
    <h4 class="lux-subtitle mb-3">Reservas Activas</h4>

    <div class="lux-panel">
        <div class="table-responsive">
            <table class="table lux-table mb-0">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Servicio</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                    </tr>
                </thead>

                <tbody>
                    {% for r in reservas %}
                    <tr>
                        <td>{{ r.usuario.username }}</td>
                        <td>{{ r.servicio.nombre }}</td>
                        <td>{{ r.fecha }}</td>
                        <td class="lux-gold">{{ r.hora }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center lux-muted py-4">
                            No hay reservas futuras
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- ================= JS (SIN CAMBIOS) ================= -->
<script>
document.querySelector("input[name='fecha']").addEventListener("change", function () {
    const fecha = this.value;

    fetch(`/admin-reservas/horarios-disponibles/?fecha=` + fecha)
        .then(res => res.json())
        .then(data => {
            let select = document.querySelector("select[name='hora']");
            select.innerHTML = "";

            if (data.length === 0) {
                select.innerHTML = `<option value="">No hay horarios disponibles</option>`;
                return;
            }

            data.forEach(h => {
                select.innerHTML += `<option value="${h}">${h}</option>`;
            });
        });
});
</script>

<style>
/* ===== ADMIN RESERVAS LUX ===== */

.lux-admin-container{
    max-width: 1200px;
    margin: auto;
}

.lux-title{
    color:#f5f5f7;
    font-weight:900;
}

.lux-subtitle{
    color:#f3d36b;
    font-weight:800;
}

/* PANEL */
.lux-panel{
    background: rgba(0,0,0,0.55);
    border: 1px solid rgba(212,175,55,0.25);
    border-radius:18px;
    box-shadow:0 25px 60px rgba(0,0,0,0.55);
    padding: 20px;
}

/* INPUTS */
.lux-label{
    color: rgba(245,245,247,.75);
    font-weight:800;
    font-size:13px;
}

.lux-input{
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(228, 38, 38, 0.18);
    color: #f5f5f7;
    border-radius: 12px;
}

.lux-input:focus{
    border-color: rgba(212,175,55,.55);
    box-shadow: 0 0 0 .2rem rgba(212,175,55,.15);
    background: rgba(0,0,0,0.45);
    color:#fff;
}

/* TABLA */
.lux-table{
    color: rgba(245,245,247,0.92);
}

.lux-table thead th{
    background: linear-gradient(90deg, rgba(212,175,55,0.18), rgba(0,0,0,0.55));
    color: 
    rgba(255, 255, 255, 0.85);
    font-size:12px;
    letter-spacing:.3px;
    text-transform: uppercase;
    border-bottom: 1px solid rgba(212,175,55,0.25);
}

.lux-table tbody tr td{
    background: transparent;
    border-top: 1px solid rgba(214, 23, 147, 0.08);
}

.lux-table tbody tr:hover td{
    color: #f3d36b;
}

/* TEXTO */
.lux-gold{
    color:#f3d36b;
    font-weight:900;
}

.lux-muted{
    color: rgba(245,245,247,0.55);
}

/* BOTONES */
.lux-btn-gold{
    background: linear-gradient(135deg,#d4af37,#f3d36b);
    color:#111;
    font-weight:900;
    border-radius:14px;
    padding:10px 18px;
    border:none;
}

.lux-btn-outline{
    border:1px solid rgba(212,175,55,0.45);
    color:#f3d36b;
    background: rgba(0,0,0,0.25);
    border-radius:12px;
    font-weight:800;
}

.lux-table tbody td{
  color: #ffffff !important;
  opacity: 1 !important;
}


.lux-table tbody td *{
  color: #ffffff !important;
}

.lux-input::placeholder{
  color: rgba(255,255,255,.85) !important;
  opacity: 1 !important;
}

.lux-input option{
  color: #ffffff !important;
  background: #0b0b0b;
}


.lux-input[type="date"]{
  color: #ffffff !important;
}
.lux-input[type="date"]::-webkit-datetime-edit,
.lux-input[type="date"]::-webkit-datetime-edit-text,
.lux-input[type="date"]::-webkit-datetime-edit-month-field,
.lux-input[type="date"]::-webkit-datetime-edit-day-field,
.lux-input[type="date"]::-webkit-datetime-edit-year-field{
  color: #ffffff !important;
}
</style>

{% endblock %}
