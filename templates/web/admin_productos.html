{% extends "web/base.html" %}
{% load formatos %}
{% block title %}Administrar Productos{% endblock %}

{% block content %}

<div class="lux-admin-container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="lux-title">GestiÃ³n de Productos</h2>

        <a class="btn lux-btn-gold" href="{% url 'admin_producto_crear' %}">
            + Nuevo Producto
        </a>
    </div>

    <!-- ================= TABLA PRODUCTOS ================= -->
    <div class="lux-panel mb-5">
        <div class="table-responsive">
            <table class="table lux-table mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Imagen</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    {% for p in productos %}
                    <tr>
                        <td>{{ p.id }}</td>
                        <td class="fw-bold">{{ p.nombre }}</td>

                        <!-- PRECIO EN BLANCO -->
                        <td class="lux-price">${{ p.precio|precio_cl }}</td>

                        <td>{{ p.stock }}</td>
                        <td class="lux-muted">{{ p.imagen }}</td>

                        <td class="text-end">
                            <a class="btn btn-sm lux-btn-outline"
                               href="{% url 'admin_producto_editar' p.id %}">
                                Editar
                            </a>

                            <a class="btn btn-sm lux-btn-danger ms-1"
                               href="{% url 'admin_producto_eliminar' p.id %}"
                               onclick="return confirm('Â¿Eliminar producto?')">
                               Eliminar
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center lux-muted py-4">
                            No hay productos cargados.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ================= COMPRAS ================= -->
    <h3 class="lux-subtitle mb-3">Compras realizadas</h3>

    <div class="lux-panel">
        <div class="table-responsive">
            <table class="table lux-table mb-0">
                <thead>
                    <tr>
                        <th>ID Orden</th>
                        <th>Usuario</th>
                        <th>Fecha</th>
                        <th>Total</th>
                        <th>Detalles</th>
                    </tr>
                </thead>

                <tbody>
                    {% for o in compras %}
                    <tr>
                        <td>#{{ o.id }}</td>
                        <td>{{ o.usuario.username }}</td>
                        <td>{{ o.fecha }}</td>

                        <!-- TOTAL EN BLANCO -->
                        <td class="lux-price">${{ o.total|precio_cl }}</td>

                        <td>
                            <ul class="lux-list">
                                {% for item in o.items.all %}
                                    <li>
                                        {{ item.producto.nombre }}
                                        <span class="lux-muted">
                                            x{{ item.cantidad }} â€”
                                            ${{ item.subtotal|precio_cl }}
                                        </span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center lux-muted py-4">
                            No hay compras registradas.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<style>
/* ===== ADMIN LUX (TABLA NEGRA + DORADO) ===== */

.lux-admin-container{
    max-width: 1200px;
    margin: auto;
}

.lux-title{
    color:#f5f5f7;
    font-weight:900;
}

.lux-subtitle{
    color:#f3d36b;
    font-weight:800;
}

/* PANEL */
.lux-panel{
    background: rgba(0,0,0,0.55);
    border: 1px solid rgba(212,175,55,0.25);
    border-radius:18px;
    box-shadow:0 25px 60px rgba(0,0,0,0.55);
    overflow:hidden;
}

/* TABLA FULL OSCURA (IMPORTANTE) */
.lux-table{
    color: rgba(245,245,247,0.92);
    background: transparent !important;
    margin-bottom: 0;
}

/* encabezados */
.lux-table thead th{
    background: linear-gradient(90deg, rgba(212,175,55,0.18), rgba(0,0,0,0.55)) !important;
    color: rgba(245,245,247,0.85) !important;
    text-transform:uppercase;
    font-size:12px;
    letter-spacing:.35px;
    border-bottom: 1px solid rgba(212,175,55,0.25) !important;
}

/* ðŸ‘‡ ESTO ES LO QUE TE FALTA: FORZAR TBODY NEGRO */
.lux-table tbody{
    background: rgba(0,0,0,0.62) !important;
}

.lux-table tbody tr{
    background: transparent !important;
}

.lux-table tbody td{
    background: transparent !important;
    color: rgba(245,245,247,0.92) !important;
    border-top: 1px solid rgba(255,255,255,0.08) !important;
    vertical-align: middle;
}

/* Hover elegante */
.lux-table tbody tr:hover td{
    background: rgba(212,175,55,0.06) !important;
}

/* PRECIO / TOTAL EN BLANCO */
.lux-price{
    color: #ffffff !important;
    font-weight: 900;
}

/* Texto gris */
.lux-muted{
    color: rgba(245,245,247,0.60) !important;
}

/* BOTONES */
.lux-btn-gold{
    background: linear-gradient(135deg,#d4af37,#f3d36b);
    color:#111 !important;
    font-weight:900;
    border-radius:14px;
    padding:10px 18px;
    border:none;
}

.lux-btn-outline{
    border:1px solid rgba(212,175,55,0.45);
    color:#f3d36b !important;
    background: rgba(0,0,0,0.25);
    border-radius:12px;
    font-weight:800;
}

.lux-btn-danger{
    background: rgba(239,68,68,0.15);
    border: 1px solid rgba(239,68,68,0.35);
    color: #ffb4b4 !important;
    border-radius:12px;
    font-weight:800;
}

/* LISTA */
.lux-list{
    padding-left:16px;
    margin-bottom:0;
}
</style>

{% endblock %}
